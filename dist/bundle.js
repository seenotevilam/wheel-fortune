(()=>{var t={110:(t,e,i)=>{let n=i(385),a=i(651);t.exports=class{constructor(t,e,i,n,a,s){this._eventManager=i,this._storage=n,this._state=s,this._variantList=s.variantList,this._colorStack=a,this._initEvents()}_initEvents(){let t=this;this._eventManager.subscribe("clicked.variant.add",(function(e,i){let n=i.value;t.addVariant(n)})),this._eventManager.subscribe("clicked.variant.delete",(function(e,i){let n=i.value;t.deleteVariant(n)})),this._eventManager.subscribe("clicked.variant.randomize",(function(){t.randomize()})),this._eventManager.subscribe("variant.randomized",(function(e,i){t._storage.save(t._state)})),this._eventManager.subscribe("variant.deleted",(function(){t._storage.save(t._state)})),this._eventManager.subscribe("variant.added",(function(){t._storage.save(t._state)}))}randomize(){if(this._state.wheel.isRunning)return;let t=this._variantList.noDrawnVariants(),e=t.length;if(e<=1)return;let i=t[Math.floor(Math.random()*e)];i.isDrawn=!0,this._variantList._lastDrawn=i,this._eventManager.publish(new a("variant.randomize",i))}addVariant(t){if(this._state.wheel.isRunning)return;let e=this._createNewVariant(t);this._variantList.add(e),this._eventManager.publish(new a("variant.added"))}deleteVariant(t){if(this._state.wheel.isRunning)return;let e=this._variantList.variants[t];this._state.variantList.lastDrawn.id==t&&(console.log(this._state.variantList.lastDrawn),this._state.variantList.lastDrawn=new n),this._colorStack.push(e.color),this._variantList.delete(e.id),this._eventManager.publish(new a("variant.deleted",e))}_createNewVariant(t){let e=this._variantList.variants.length,i=this._colorStack.pop();return new n(e,t,i)}}},651:t=>{t.exports=class{constructor(t,e=void 0){this._value=e,this._name=t}get value(){return this._value}get name(){return this._name}}},481:t=>{t.exports=class{subscribe(t,e){$(this).bind(t,e)}publish(t){$(this).trigger(t.name,t)}}},74:t=>{t.exports=class t{static defaultColors=["#00d25b","#fc424a","#ffab00","#0090e7","#336633","#8f5fe8","#17a2b8","#6610f2"];constructor(e=[]){let i=this;this._colorListStack=[],t.defaultColors.forEach((function(t){i._inArray(t,e)||i._colorListStack.push(t)}))}pop(){return 0===this._colorListStack.length&&this._fillStackByDefaultsColor(),this._colorListStack.pop()}push(t){this._colorListStack.push(t)}_fillStackByDefaultsColor(){let e=this,i=t.defaultColors.pop();t.defaultColors.unshift(i),t.defaultColors.forEach((function(t){e._colorListStack.push(t)}))}_inArray(t,e){for(let i=0;i<e.length;i++)if(e[i]===t)return!0;return!1}}},316:t=>{t.exports=class{constructor(t,e){this._variantList=t,this._wheel=e}get variantList(){return this._variantList}set variantList(t){this._variantList=t}get wheel(){return this._wheel}set wheel(t){this._wheel=t}}},115:(t,e,i)=>{let n=i(316),a=i(385),s=i(401),r=i(998);t.exports=class{constructor(t){this.key=t,this.localStorage=localStorage}load(){let t=JSON.parse(this.localStorage.getItem(this.key));if(null===t)return this._createNullState();let{wheel:e,variantList:i}=this._createFromStorageLoad(t);return new n(i,e)}_createFromStorageLoad(t){let e=this._getVariants(t._variantList._variants),i=new a(t._variantList._lastDrawn._id,t._variantList._lastDrawn._label,t._variantList._lastDrawn._color,t._variantList._lastDrawn.isDrawn),n=new s(t._label,i,e);return{wheel:new r(t._wheel._degrees,t._wheel.isRunning),variantList:n}}_createNullState(){return new n(new s(this.key,new a),new r)}_getVariants(t){let e=[];return t.forEach((function(t){let i=new a(t._id,t._label,t._color,t._isDrawn);e.push(i)})),e}save(t){this.localStorage.setItem(this.key,JSON.stringify(t))}delete(){this.localStorage.removeItem(this.key)}}},385:t=>{t.exports=class{constructor(t=-1,e="",i="",n=!1){this._id=t,this._label=e,this._isDrawn=n,this._color=i}get label(){return this._label}get isDrawn(){return this._isDrawn}get id(){return this._id}get color(){return this._color}set color(t){this._color=t}set isDrawn(t){this._isDrawn=t}set id(t){this._id=t}}},401:(t,e,i)=>{let n=i(385);t.exports=class{constructor(t,e=null,i=[]){this._label=t,this._variants=i,this._lastDrawn=null===e?new n:e}get label(){return this._label}get variants(){return this._variants}get lastDrawn(){return this._lastDrawn}noDrawnVariants(){let t=[];return this._variants.forEach((function(e){e.isDrawn||t.push(e)})),t}add(t){this._variants.push(t)}set lastDrawn(t){this._lastDrawn=t}get colors(){let t=[];return this._variants.forEach((function(e){t.push(e.color)})),t}delete(t){this._variants.splice(t,1);let e=0;this._variants.forEach((function(t){t.id=e,e++}))}clear(){this._variants=[]}}},998:t=>{t.exports=class{constructor(t=0,e=!1){this._degrees=t,this._isRunning=e}set degrees(t){this._degrees=t}set isRunning(t){this._isRunning=t}get isRunning(){return this._isRunning}get degrees(){return this._degrees}}},827:t=>{t.exports=class{constructor(t,e,i,n){this._$view=t,this._$view.html(this._template()),this._eventManager=i,this._variantList=n.variantList}_template(){return'  <div class="section-title col-lg-12 col-md-12 " role="alert">\n                <h4 class="Alert" style="color: #e53637">Выпало </h4>\n            </div>\n            <div style="clear: both"></div>\n            <div class="col-lg-7 col-md-7">\n                <div class="anime__details__title">\n                    <h3 class="Title"></h3>\n                </div>\n                <div class="anime__details__btn">\n                    <label class="form-label">\n                        <input class="form-control addNewVariantInput">\n                    </label>\n                    <button href="#" class="follow-btn  addNewVariantButton"><span>Добавить</span>\n                        <i class="fa fa-angle-right"></i>\n                    </button>\n                </div>\n                <div class="anime-details anime__details__btn">\n                    <ul class="list list-group list-group-numbered">\n                        <div class="anime__review__item">\n                            <li class="anime__review__item__text list-group-item d-flex justify-content-between align-items-start">\n                                <div style="margin-bottom: 0; margin-top: 10px;" class="section-title">\n                                    <h5 class="label">Вариант 1</h5>\n                                </div>\n                                <label style="display:none;" class="id">0</label>\n                                <button href="#" class="follow-btn deleteVariantButton">\n                                    Удалить</button>\n                            </li>\n                        </div>\n                    </ul>\n                </div>\n            </div>\n            <div class="col-lg-5 col-md-5 text-center anime__details__title text-center">\n                <div class="anime__details__sidebar wheel_block">\n                    <div class="wheel_drum_container">\n                       <div class="wheel wheel_drum">\n                           <ul class="wheel_text"></ul>\n                       </div>\n                    </div>\n                    <div style="clear: both"></div>\n                    <div class="anime__details__btn">\n                        <button href="" class="randomVariantButton disabled follow-btn"><i module="fa fa-heart-o"></i>\n                            Крутите барабан</button>\n                    </div>\n                </div>\n            </div>'}}},193:t=>{t.exports=class{constructor(t,e,i){this._currentVaraint=i,this._eventManager=e,this._$alert=$(t.find(".Alert").get(0)),this._initEvents(),this._show(i)}_initEvents(){let t=this;this._eventManager.subscribe("variant.randomize",(function(){t._hide()})),this._eventManager.subscribe("variant.randomized",(function(e,i){t._currentVaraint=i.value,t._show(t._currentVaraint)})),this._eventManager.subscribe("variant.deleted",(function(e,i){i.value.id===t._currentVaraint.id&&t._hide()}))}_hide(){this._$alert.hide()}_show(t){if(t.id<0)return"";this._$alert.css("color",t.color),this._$alert.html("Выпало "+t.label),this._$alert.show()}}},579:(t,e,i)=>{let n=i(651);t.exports=class{constructor(t,e,i=!1){this._elementList=t,this._eventManager=e,this._isBlocked=i,this._initButtons(),this._initEvents(),i&&this._block(!0)}_initButtons(){this._addButton=this._elementList.find(".addNewVariantButton"),this._addInput=this._elementList.find(".addNewVariantInput"),this._deleteButton=this._elementList.find(".deleteVariantButton"),this._randomizeButton=this._elementList.find(".randomVariantButton")}_initEvents(){let t=this;this._eventManager.subscribe("clicked.variant.randomize",(function(e,i){t._block(!0)})),this._eventManager.subscribe("variant.randomized",(function(e,i){t._block(!1)})),this._initAddNewVariant(),this._initDeleteVariant(),this._initRandomizeVariant()}_block(t){this._isBlocked=t,this._addButton.prop("disabled",t),this._addInput.prop("disabled",t),this._elementList.find(".deleteVariantButton").prop("disabled",t),this._randomizeButton.prop("disabled",t)}_initAddNewVariant(){let t=this,e=this._addInput;this._addButton.on("click",(function(i){i.preventDefault(),i.stopPropagation(),t._isBlocked||t.formSubmitted(e,t)})),this._addInput.keypress((function(i){if(!t._isBlocked)return 13===i.which?(t.formSubmitted(e,t),!1):void 0}))}formSubmitted(t,e){let i=t.val();0!==i.length&&(t.val(""),e._eventManager.publish(new n("clicked.variant.add",i)))}_initDeleteVariant(){let t=this;t._isBlocked||this._deleteButton.live("click",(function(e){e.preventDefault(),e.stopPropagation();let i=$(this).prev().text();t._eventManager.publish(new n("clicked.variant.delete",i))}))}_initRandomizeVariant(){let t=this;t._isBlocked||this._randomizeButton.on("click",(function(e){e.preventDefault(),e.stopPropagation(),t._eventManager.publish(new n("clicked.variant.randomize"))}))}}},752:t=>{t.exports=class{constructor(t,e,i,n,a){this._list=new List(t,{valueNames:["label","id","isDrawn"]}),this._eventManager=n,this._variantList=a,this._initEvents(),this._renderTitle(e,i),this._update(this._variantList.variants)}_renderTitle(t,e){$(t).find(".Title").get(0).innerHTML=e}_initEvents(){let t=this;this._eventManager.subscribe("variant.added",(function(){t._update()})),this._eventManager.subscribe("variant.deleted",(function(){t._update()})),this._eventManager.subscribe("variant.randomized",(function(){t._update()}))}_update(){let t=this._getVariantListElements(this._variantList.variants);this._list.clear(),this._list.add(t),this._list.items.forEach((function(t){let e=t.values();e.isDrawn&&$(t.elm).addClass("anime__review__item__text_active").css("border-color",e.color)}))}_getVariantListElements(t){let e=[];return t.forEach((function(t){e.push({label:t.id+1+" "+t.label,id:t.id,isDrawn:t.isDrawn,color:t.color})})),e}}},11:(t,e,i)=>{let n=i(651);t.exports=class{constructor(t,e,i,n){this._eventManager=e,this._wheel=n,this._variantList=i,this._initEvents(),this._initViewElements(t),this._update()}_initViewElements(t){this._$block=$(t.find(".wheel_block").get(0)),this._$wheelContainer=$(t.find(".wheel_drum_container").get(0))}_initEvents(){let t=this;this._eventManager.subscribe("variant.added",(function(){t._variantList.lastDrawn.id>0||(t._wheel.degrees=0,t._update())})),this._eventManager.subscribe("variant.deleted",(function(e,i){t._variantList.lastDrawn.id>=0||(t._wheel.degrees=0,t._update())})),this._eventManager.subscribe("variant.randomize",(function(e,i){let n=i.value;t._wheel.degrees=0,t._update(n),t._run(n)}))}_update(){if(this._wheel.isRunning)return;let t=this._getVariantsForRenderSectors(this._variantList.variants,this._variantList.lastDrawn),e=Math.round(100/t.length);this._render(t,e)}_calculateDeltaDegrees(t,e){let i=t.length,n=(2+Math.floor(2*Math.random()))*i+(i-e),a=Math.round(360/i),s=Math.round(a/4+Math.floor(Math.random()*a/2));return Math.round(n*a-s+90)}_getWinnerIndex(t,e){let i=-1;return t.forEach((function(t,n){t.id===e.id&&(i=n)})),i}_render(t,e){let i=this;this._$block.show(),this._$wheelContainer.html(this._template()),this._$dram=$(this._$wheelContainer.find(".wheel_drum").get(0)),this._$dram.css("transform","rotate("+this._wheel.degrees+"deg)"),this._$text=$(this._$wheelContainer.find(".wheel_text").get(0));let n="",a=e,s=Math.round(360/t.length)/2,r=90+s;t.forEach((function(l,o){let _=i._createLi(r,l);i._$text.append(_),r+=s+s,o+1===t.length?n+=l.color+" 0 ":n+=l.color+" 0 "+a+"%, ",a=Math.round(a+e)})),this._$dram.css("background-image","conic-gradient("+n+")"),t.length<=1&&this._variantList.lastDrawn.id<0&&this._$block.hide()}_run(t){let e=this;if(this._wheel.isRunning)return;let i=this._getVariantsForRenderSectors(this._variantList.variants,t);if(1===i.length)return;let a=this._getWinnerIndex(i,t),s=this._calculateDeltaDegrees(i,a);this._wheel.isRunning=!0,$({deg:0}).animate({deg:s},{duration:1e4,step:function(t){e._$dram.css({transform:"rotate("+t+"deg)"})},complete:function(){e._wheel.isRunning=!1,e._wheel.degrees=s,e._eventManager.publish(new n("variant.randomized",t))}})}_createLi(t,e){return $("<li></li>").css("transform","rotate("+t+"deg)").html(e.id+1)}_getVariantsForRenderSectors(t,e=null){let i=[];return t.forEach((function(t){(!t.isDrawn||null!==e&&e.id===t.id)&&i.push(t)})),i}_template(){return'<div class= "arrow"></div>\n<div class="wheel wheel_drum">\n   <ul class="wheel_text">   </ul>\n </div>'}}}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}(()=>{i(651);let t=i(481),e=i(74),n=(i(316),i(115)),a=(i(385),i(401),i(998),i(827)),s=i(193),r=i(579),l=i(752),o=i(11),_=i(110);function h(i,h){let d=$("#"+i),c=new n(i),u=c.load(),v=new t,g=new e;new a(d,h,v,u),new l(i,d,h,v,u.variantList),new o(d,v,u.variantList,u.wheel),new r(d,v),new s(d,v,u.variantList.lastDrawn),new _(d,h,v,c,g,u)}h("i-want-it","Колесо важных дел"),h("i-wish-it","Колесо Хочух")})()})();